---
title: "äººå·¥è¡›æ˜Ÿã®ä½ç½®ã‚’Webåœ°å›³ä¸Šã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã™ã‚‹"
emoji: "ğŸ›°ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React", "MapLibre"]
published: true
---

FOSS4G Advent Calendar 2024 ã® 23 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

https://qiita.com/advent-calendar/2024/foss4g

ã“ã®è¨˜äº‹ã§ã¯ã€äººå·¥è¡›æ˜Ÿã®ä½ç½®ã‚’ Web åœ°å›³ä¸Šã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã™ã‚‹ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª react-sat-map ã¨ãã®å®Ÿè£…ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

https://github.com/sankichi92/react-sat-map

## ãƒ‡ãƒ¢

ã¯ã˜ã‚ã«ã€react-sat-map ãŒã©ã‚“ãªã‚‚ã®ã‹ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚
https://sankichi92.github.io/react-sat-map/

ä»¥ä¸‹ã¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ãŸã‚å‹•ã‹ãªã„ã§ã™ãŒã€å®Ÿéš›ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã§ã¯è¡›æ˜Ÿã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚Šã€åœ°å›³ã‚’æ‹¡å¤§ãƒ»ç¸®å°ã—ãŸã‚Šã—ã¦ã€è¡›æ˜Ÿã®åå‰ã‚„å®Ÿéš›ã®å‹•ãã‚’ç¢ºèªã§ãã¾ã™ã€‚
[![ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ](/images/2024-12-23_react-sat-map/demo_screenshot.png)](https://sankichi92.github.io/react-sat-map/)

ãƒ‡ãƒ¢ã§è¡¨ç¤ºã—ã¦ã„ã‚‹ã®ã¯ã€ç›´è¿‘ 30 æ—¥ä»¥å†…ã«æ‰“ä¸Šã’ã‚‰ã‚ŒãŸè¡›æ˜Ÿã§ã™ã€‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§åå‰ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ YODAKA (AE1b) ã¯ã€ç§ã®æ‰€å±ã™ã‚‹ã‚¢ãƒ¼ã‚¯ã‚¨ãƒƒã‚¸ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ãŒé–‹ç™ºã—ãŸè¡›æ˜Ÿã§ã€12/9 ã«å›½éš›å®‡å®™ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰æ”¾å‡ºã•ã‚Œã¾ã—ãŸï¼ˆå®£ä¼ï¼‰ã€‚

https://arkedgespace.com/news/2024-12-10_ae1b_yodaka_onglaisat

YODAKA ã§ã¯ã€ã€ŒçŸ­æ­ŒãƒŸãƒƒã‚·ãƒ§ãƒ³ã€ã®ä¸Šã®å¥ã‚’å‹Ÿé›†ä¸­ã§ã™ã€‚

https://up-hanamaki.com/article/239/

## react-sat-map ã®ä½¿ã„æ–¹

react-sat-map ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦é…å¸ƒã—ã¦ã„ã¾ã™ï¼ˆã“ã®è¨˜äº‹ã‚’æ›¸ãç›´å‰ã«é§†ã‘è¾¼ã¿ã§ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸï¼‰ã€‚

https://www.npmjs.com/package/react-sat-map

react-sat-map ã‚’ä½¿ã†ã«ã¯ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚åˆã‚ã›ã¦å¿…è¦ã§ã™ã€‚

- [React](https://react.dev/) [^1]
- [react-map-gl](https://visgl.github.io/react-map-gl/)
- [MapLibre GL JS](https://maplibre.org/maplibre-gl-js/docs/)

[^1]: å…ˆæ—¥ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã°ã‹ã‚Šã® React v19 ãŒå¿…è¦ã§ã™ã€‚æœ€æ–°ç‰ˆã§ã¤ãã‚Šã¯ã˜ã‚ã¦ã€è¨˜äº‹ã‚’æ›¸ãç›´å‰ã« v18 ã§å‹•ä½œç¢ºèªã—ãŸã‚‰å‹•ãã¾ã›ã‚“ã§ã—ãŸâ€¦â€¦ã€‚

react-sat-map ã®ãƒ¡ã‚¤ãƒ³ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ `SatelliteMarkers` ã§ã™ã€‚`react-map-gl/maplibre` ã® `Map` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å°è¦ç´ ã¨ã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚`satellites` prop ã«è¡›æ˜Ÿã®åå‰ã¨ TLEï¼ˆã“ã®ã‚ã¨èª¬æ˜ã—ã¾ã™ï¼‰ã‚’ã‚‚ã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã«ã€YODAKA ã®ä½ç½®ã‚’åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```jsx
import { Map } from "react-map-gl/maplibre";
import { SatelliteMarkers } from "react-sat-map";
import "maplibre-gl/dist/maplibre-gl.css";
import "react-sat-map/style.css";

const satellites = [
  {
    name: "YODAKA",
    tle: {
      line1:
        "1 62295U 98067XB  24357.77132066  .00177505  00000+0  25824-2 0  9994",
      line2:
        "2 62295  51.6366 100.8197 0012760   9.6944 350.4290 15.54538666  2102",
    },
  },
];

export default function App() {
  return (
    <Map
      style={{ height: "100dvh" }}
      mapStyle="https://tile.openstreetmap.jp/styles/maptiler-basic-ja/style.json"
    >
      <SatelliteMarkers satellites={satellites} />
    </Map>
  );
}
```

ã“ã“ã‹ã‚‰ã¯ã€`SatelliteMarkers` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

## TLE ã‹ã‚‰è¡›æ˜Ÿã®ä½ç½®ã‚’è¨ˆç®—ã™ã‚‹

ã¾ãšã¯ã€è¡›æ˜Ÿã®ç¾åœ¨ä½ç½®ã‚’å–å¾—ã—ã¾ã—ã‚‡ã†ã€‚

è¡›æ˜Ÿã®ä½ç½®ã¯ 2 è¡Œè»Œé“è¦ç´ ã€TLE (Two-Line Elements) ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ã€‚TLE ã¯ã€äººå·¥è¡›æ˜Ÿç­‰ã®è»Œé“ã‚’è¡¨ã™ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã§ã€[CelesTrak](https://celestrak.org/) ã‚„ [Space-Track](https://www.space-track.org/)ï¼ˆè¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰ã§é…å¸ƒã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šè¨˜ã®ä¾‹ã® `line1` ã¨ `line2` ãŒãã‚Œãã‚Œ TLE ã® 1 è¡Œç›®ã¨ 2 è¡Œç›®ã«ã‚ãŸã‚Šã¾ã™ã€‚<!-- textlint-disable -->

TLE ã®å†…å®¹ã¯ã“ã“ã§ã¯èª¬æ˜ã—ã¾ã›ã‚“[^2]ãŒã€è¡›æ˜Ÿã¯ TLE ã§è¡¨ç¾ã•ã‚Œã‚‹è»Œé“ä¸Šã§é‹å‹•ã‚’ç¶šã‘ã‚‹ã®ã§ã€SGP4 ã¨ã„ã£ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã£ã¦ã€ã‚ã‚‹æ™‚åˆ»ã«ã©ã“ã«ã„ã‚‹ã‹ã‚’æ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™[^3]ã€‚<!-- textlint-enable -->

[^2]: TLE ã«ã¤ã„ã¦ã¯ã¤ãã®ãƒšãƒ¼ã‚¸ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™: https://lizard-tail.com/isana/tle/misc/what_is_tle
[^3]: å®Ÿéš›ã«ã¯å¤–ä¹±ã«ã‚ˆã‚Šè»Œé“ã¯åˆ»ã€…ã¨å¤‰åŒ–ã—ã¦ã„ãã®ã§ã€TLE ã¯æ—¥ã€…æ›´æ–°ã•ã‚Œã¾ã™ã€‚

[satellite.js](https://github.com/shashwatak/satellite-js) ã¯ã€SGP4 ã® JavaScript å®Ÿè£…ã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ TLE ã¨æ™‚åˆ»ã‹ã‚‰ç·¯åº¦çµŒåº¦ã‚’è¨ˆç®—ã§ãã¾ã™ã€‚

```javascript
import * as satellite from "satellite.js";

function twoline2geodetic(line1, line2, date = new Date()) {
  const satrec = satellite.twoline2satrec(line1, line2);
  const { position } = satellite.propagate(satrec, date);

  // å¾—ã‚‰ã‚ŒãŸ position ã¯ ECI åº§æ¨™ç³»ãªã®ã§ã€ç·¯åº¦çµŒåº¦ã®æ¸¬åœ°åº§æ¨™ç³»ã«å¤‰æ›ã™ã‚‹
  const location = satellite.eciToGeodetic(position, satellite.gstime(date));

  // ãƒ©ã‚¸ã‚¢ãƒ³ã‹ã‚‰åº¦æ•°æ³•ã«å¤‰æ›ã™ã‚‹
  const longitude = satellite.degreesLong(location.longitude);
  const latitude = satellite.degreesLat(location.latitude);

  return { longitude, latitude };
}
```

## Web åœ°å›³ä¸Šã«è¡›æ˜Ÿã‚’è¡¨ç¤ºã™ã‚‹

è¡›æ˜Ÿã®ä½ç½®ãŒå–å¾—ã§ããŸã®ã§ã€ã¤ãã¯ Web åœ°å›³ä¸Šã«è¡¨ç¤ºã—ã¾ã™ã€‚

TLE ã¨æ™‚åˆ»ã‚’ props ã¨ã—ã¦å—ã‘å–ã‚Šã€`react-map-gl/maplibre` ã® [`Marker`](https://visgl.github.io/react-map-gl/docs/api-reference/marker) ã‚’è¿”ã™ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã¤ãã‚Šã¾ã™ã€‚

```jsx
import { Marker } from "react-map-gl/maplibre";

function SatelliteMarker({ satellite, date = new Date() }) {
  const { longitude, latitude } = twoline2geodetic(
    satellite.tle.line1,
    satellite.tle.line2,
    date,
  );

  return (
    <Marker longitude={longitude} latitude={latitude}>
      ğŸ›°ï¸
    </Marker>
  );
}
```

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ `react-map-gl/maplibre` ã® `Map` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»¥ä¸‹ã«é…ç½®ã™ã‚Œã°ã€è¡›æ˜ŸãŒåœ°å›³ä¸Šã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ä½ç½®ã‚’æ›´æ–°ã™ã‚‹

æœ€å¾Œã«ã€è¡›æ˜Ÿã®ä½ç½®ã‚’ç¾åœ¨æ™‚åˆ»ã«åˆã‚ã›ã¦æ›´æ–°ã—ç¶šã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚<!-- textlint-disable -->

`SatelliteMarkers` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€[`window.requestAnimationFrame()`](https://developer.mozilla.org/ja/docs/Web/API/Window/requestAnimationFrame) ã‚’ä½¿ç”¨ã—ã¦ã€ç”»é¢æ›´æ–°ã®ãŸã³ `SatelliteMarker` ã«æ–°ã—ã„æ™‚åˆ»ã‚’æ¸¡ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚<!-- textlint-enable -->

```jsx
export function SatelliteMarkers({ satellites }) {
  const [date, setDate] = useState(new Date(performance.timeOrigin));

  useEffect(() => {
    const animation = requestAnimationFrame((timestamp) =>
      setDate(new Date(performance.timeOrigin + timestamp));
    );
    return () => cancelAnimationFrame(animation);
  });

  return (
    <>
      {satellites.map((satellite, i) => (
        <SatelliteMarker key={i} satellite={satellite} date={date} />
      ))}
    </>
  );
}
```

---

ä»¥ä¸ŠãŒ react-sat-map ã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹ã§ã™ã€‚å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„å®‰å®šæ€§ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ã¦ã‚‚ã†ã™ã“ã—è¤‡é›‘ã«ãªã£ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ã¯å†’é ­ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ç¾åœ¨ã® react-sat-map ã¯è¡›æ˜Ÿã®ä½ç½®ã‚’ãŸã è¡¨ç¤ºã™ã‚‹ã ã‘ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ—¢å­˜ã® OSS ã«ã¯ã‚‚ã£ã¨ã„ã‚ã„ã‚ãªæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚

- [Gpredict](https://github.com/csete/gpredict)
- [satvis](https://github.com/Flowm/satvis)
- [KeepTrack](https://github.com/thkruz/keeptrack.space)

ãŸã ã€2 æ¬¡å…ƒã® Web åœ°å›³ä¸Šã«ã‚·ãƒ³ãƒ—ãƒ«ã«è¡¨ç¤ºã™ã‚‹ã‚‚ã®ãŒè¦‹å½“ãŸã‚‰ãªã‹ã£ãŸã®ã§ã¤ãã£ã¦ã¿ã¾ã—ãŸã€‚ä»Šå¾Œä½™åŠ›ãŒã‚ã‚Œã°ã€ä¸Šè¨˜ OSS ã«å…±é€šã™ã‚‹ã‚ˆã†ãªä¸»è¦ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ããŸã„ã§ã™ã€‚
